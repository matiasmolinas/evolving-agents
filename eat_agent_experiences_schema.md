```markdown
# MongoDB Schema: eat_agent_experiences

This document defines the schema for the `eat_agent_experiences` collection in MongoDB. This collection stores records of agent experiences, capturing details about tasks, decisions, outcomes, and feedback.

## Fields

| Field Name                   | Data Type        | Description                                                                                                | Notes                                                     |
|------------------------------|------------------|------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------|
| `experience_id`              | String           | Unique identifier for the experience (e.g., UUID).                                                         | **Required**, Primary Key                                 |
| `primary_goal_description`   | String           | Description of the overall goal the agent was trying to achieve.                                           | **Required**, Embeddable                                  |
| `sub_task_description`       | String           | Description of the specific sub-task within the primary goal.                                              | **Required**, Embeddable                                  |
| `initiating_agent_id`        | String           | Identifier of the agent that initiated this task or workflow.                                              | **Required**                                              |
| `involved_components`        | List of Strings  | List of component IDs or names that were involved in this experience.                                      |                                                           |
| `input_context_summary`      | String           | Summary of the input context provided to the agent for the task.                                           | Embeddable                                                |
| `key_decisions_made`         | List of Strings  | A list of key decisions made by the agent during the task. Alternatively, can be a structured object.        |                                                           |
| `final_outcome`              | String           | Description of the final outcome of the task (e.g., 'success', 'failure', 'partial_success', 'abandoned'). | **Required**                                              |
| `output_summary`             | String           | Summary of the output generated by the agent.                                                              | Embeddable                                                |
| `feedback_signals`           | Object           | Structured feedback received for this experience.                                                          | Example: `{"user_rating": 5, "correction_needed": false, "error_type": "API_error"}` |
| `timestamp`                  | ISODate          | Timestamp indicating when the experience was recorded.                                                     | **Required**, Indexed                                     |
| `version`                    | Integer          | Version number of this schema.                                                                             | **Required**                                              |
| `workflow_id`                | String           | Optional identifier if this experience is part of a larger, defined workflow.                              | Indexed if frequently queried                               |
| `session_id`                 | String           | Optional identifier to group experiences from the same user session or interaction.                        | Indexed if frequently queried                               |
| `tags`                       | List of Strings  | Optional tags for categorizing or adding keywords to the experience.                                       | Indexed if frequently queried                               |
| `embeddings`                 | Object           | Object containing vector embeddings for fields marked as "Embeddable".                                   | Generated by `MongoExperienceStoreTool`. Example: `{"primary_goal_description_embedding": [0.1, ...], "sub_task_description_embedding": [0.2, ...]}` |

## Embeddable Fields

Fields marked as "Embeddable" are intended to have vector embeddings generated for them. These embeddings will be stored in the `embeddings` field. This allows for semantic search and similarity analysis on these textual descriptions.

- `primary_goal_description`
- `sub_task_description`
- `input_context_summary`
- `output_summary`

## Example Document

```json
{
  "experience_id": "a1b2c3d4-e5f6-7890-1234-567890abcdef",
  "primary_goal_description": "Book a flight from London to New York for next week.",
  "sub_task_description": "Find available flights on British Airways for the specified route and dates.",
  "initiating_agent_id": "agent_booking_assistant_v1",
  "involved_components": ["flight_search_api_v2", "user_preferences_db"],
  "input_context_summary": "User wants a business class seat, prefers morning departures.",
  "key_decisions_made": [
    "Decided to query British Airways API first based on user preference.",
    "Filtered out flights with layovers longer than 3 hours."
  ],
  "final_outcome": "success",
  "output_summary": "Found 3 suitable flights, presented the cheapest option to the user.",
  "feedback_signals": {
    "user_rating": 5,
    "correction_needed": false,
    "comment": "Perfect, exactly what I was looking for!"
  },
  "timestamp": "2024-07-30T10:30:00Z",
  "version": 1,
  "workflow_id": "flight_booking_workflow_001",
  "session_id": "user_session_xyz789",
  "tags": ["flight_booking", "international", "british_airways"],
  "embeddings": {
    "primary_goal_description_embedding": [0.05, -0.12, ..., 0.89],
    "sub_task_description_embedding": [0.11, 0.02, ..., -0.45],
    "input_context_summary_embedding": [-0.08, 0.25, ..., 0.67],
    "output_summary_embedding": [0.15, -0.09, ..., 0.76]
  }
}
```

## Indexing Strategy (Recommended)

- `experience_id`: Unique index.
- `timestamp`: For time-based queries and sorting.
- `initiating_agent_id`: If querying by agent is common.
- `workflow_id`: If experiences are often grouped by workflow.
- `session_id`: If experiences are often grouped by session.
- `tags`: For efficient querying by tags.
- `final_outcome`: If filtering by outcome is common.

Consider compound indexes based on common query patterns. For example, an index on (`initiating_agent_id`, `timestamp`) could be useful.
The fields within `embeddings` will be used by vector search capabilities of MongoDB.
```
